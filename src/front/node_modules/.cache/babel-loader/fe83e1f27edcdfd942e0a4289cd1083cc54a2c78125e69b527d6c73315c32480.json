{"ast":null,"code":"import _slicedToArray from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from\"react\";import axios from\"axios\";import{useParams}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default(function(_ref){var panel=_ref.panel,record=_ref.record,view=_ref.view,index=_ref.index;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];var _useParams=useParams(),viewIndex=_useParams.viewIndex;useEffect(function(){refreshData();},[record]);var refreshData=function refreshData(){axios.get(\"/customQuery\",{params:{viewIndex:viewIndex,panelIndex:index,query:panel.getMessagesQuery,primaryValue:record[view.primaryId]}}).then(function(response){setMessages(response.data);});};var sendMessage=function sendMessage(){axios.post(panel.postMessageUrl,{form:{message:message,recipientId:record[view.primaryId],secretKey:panel.secretKey}}).then(function(response){refreshData();});setMessage(\"\");};return/*#__PURE__*/_jsxs(\"div\",{children:[(messages===null||messages===void 0?void 0:messages.length)>0?/*#__PURE__*/_jsx(\"div\",{class:\"messagesContainer\",children:messages.map(function(message,index){return/*#__PURE__*/_jsxs(\"div\",{class:\"message \".concat(message[panel.isAdminField]?'adminMessage':'userMessage'),children:[message[panel.messageField],/*#__PURE__*/_jsx(\"div\",{class:\"messageDate\",children:window.moment(message[panel.datetimeField]).format(\"DD MMM [à] hh:mm\")})]},index);})}):/*#__PURE__*/_jsx(\"div\",{class:\"noData panelTable\",children:\"Aucun message\"}),/*#__PURE__*/_jsxs(\"div\",{class:\"sendMessageContainer\",children:[/*#__PURE__*/_jsx(\"textarea\",{class:\"sendMessageInput\",type:\"text\",value:message,onChange:function onChange(event){return setMessage(event.target.value);}}),/*#__PURE__*/_jsx(\"div\",{class:\"sendButton\",onClick:sendMessage,children:/*#__PURE__*/_jsx(\"i\",{class:\"fa fa-send\"})})]})]});});","map":{"version":3,"names":["useState","useEffect","axios","useParams","jsx","_jsx","jsxs","_jsxs","_ref","panel","record","view","index","_useState","_useState2","_slicedToArray","messages","setMessages","_useState3","_useState4","message","setMessage","_useParams","viewIndex","refreshData","get","params","panelIndex","query","getMessagesQuery","primaryValue","primaryId","then","response","data","sendMessage","post","postMessageUrl","form","recipientId","secretKey","children","length","class","map","concat","isAdminField","messageField","window","moment","datetimeField","format","type","value","onChange","event","target","onClick"],"sources":["/home/runner/work/galadmin/galadmin/src/front/src/components/panels/ChatPanel.js"],"sourcesContent":["import { useState, useEffect } from \"react\"\nimport axios from \"axios\";\nimport {\n    useParams\n} from \"react-router-dom\";\n\nexport default ({ panel, record, view, index }) => {\n    const [messages, setMessages] = useState(null);\n\tconst [message, setMessage] = useState(\"\");\n    const { viewIndex } = useParams();\n\n    useEffect(() => {\n        refreshData()\n    }, [record])\n\n    const refreshData = () => {\n        axios.get(\"/customQuery\", {\n            params: {\n                viewIndex,\n                panelIndex: index,\n                query: panel.getMessagesQuery,\n                primaryValue: record[view.primaryId]\n            }\n        }).then((response) => {\n            setMessages(response.data)\n        })\n    }\n\n\tconst sendMessage = () => {\n\t\taxios.post(panel.postMessageUrl, {\n\t\t\tform: {\n\t\t\t\tmessage,\n\t\t\t\trecipientId: record[view.primaryId],\n\t\t\t\tsecretKey: panel.secretKey\n\t\t\t}\n\t\t}).then((response) => {\n\t\t\trefreshData();\n\t\t})\n\t\tsetMessage(\"\")\n\t}\n\n    return (\n        <div>\n\t\t\t{messages?.length > 0 ? (\n\t\t\t\t<div class=\"messagesContainer\">\n\t\t\t\t\t{messages.map((message, index) => (\n\t\t\t\t\t\t<div key={index} class={`message ${message[panel.isAdminField] ? 'adminMessage' : 'userMessage'}`}>\n\t\t\t\t\t\t\t{message[panel.messageField]}\n\t\t\t\t\t\t\t<div class=\"messageDate\">{window.moment(message[panel.datetimeField]).format(\"DD MMM [à] hh:mm\")}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\t\t\t) : (\n\t\t\t\t<div class={`noData panelTable`}>Aucun message</div>\n\t\t\t)}\n\t\t\t<div class=\"sendMessageContainer\">\n\t\t\t\t<textarea class=\"sendMessageInput\" type=\"text\" value={message} onChange={(event) => setMessage(event.target.value)} />\n\t\t\t\t<div class=\"sendButton\" onClick={sendMessage}><i class=\"fa fa-send\"></i></div>\n\t\t\t</div>\n        </div>\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}