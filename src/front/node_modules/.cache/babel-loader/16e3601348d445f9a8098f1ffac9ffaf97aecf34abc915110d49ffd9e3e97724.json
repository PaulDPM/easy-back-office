{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _defineProperty from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _asyncToGenerator from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useRef,useState}from\"react\";import axios from\"axios\";import{useParams}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default(function(_ref){var column=_ref.column,onChange=_ref.onChange,initialData=_ref.initialData;var form=useRef(null);var _useParams=useParams(),viewIndex=_useParams.viewIndex;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var _useState3=useState(initialData===null||initialData===void 0?void 0:initialData[column.name]),_useState4=_slicedToArray(_useState3,2),path=_useState4[0],setPath=_useState4[1];var onInputChange=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var f,response,fileData;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:f=new FormData(form.current);setIsLoading(true);_context.next=4;return axios({method:\"post\",url:\"/uploadFile\",data:f,params:{viewIndex:viewIndex,columnId:column.__id__},headers:{\"Content-Type\":\"multipart/form-data\"}});case 4:response=_context.sent;fileData=_defineProperty({},column.name,response.data.path);if(column.aspectRatioField){fileData[column.aspectRatioField]=response.data.aspectRatio;}if(column.originalNameField){fileData[column.originalNameField]=response.data.originalFilename;}onChange(fileData);setIsLoading(false);setPath(response.data.path);// var showAsPicture = $(this).data(\"showAsPicture\") === 1\n//var baseUrl = $(\".fileInputContent[data-input-id='\" + inputId + \"']\").data(\"baseUrl\")\n//$(\".fileInputContent[data-input-id='\" + inputId + \"']\").removeClass(\"clickToSelectFile\").html(showAsPicture ? \"<div><img src='https://res.cloudinary.com/forest2/image/fetch/w_600,h_300,c_fit/\" + baseUrl + data.path + \"' /><div class='deleteFile'><i class='fal fa-trash-alt'></i></div></div>\" : \"<div class='nonImageFileOutput'><span>Fichier téléchargé</span><div class='deleteFile'><i class='fal fa-trash-alt'></i></div></div>\"\ncase 11:case\"end\":return _context.stop();}},_callee);}));return function onInputChange(){return _ref2.apply(this,arguments);};}();var deleteFile=function deleteFile(e){setPath(null);var fileData=_defineProperty({},column.name,null);if(column.aspectRatioField){fileData[column.aspectRatioField]=null;}if(column.originalNameField){fileData[column.originalNameField]=null;}onChange(fileData);e.preventDefault();};var id=Math.random().toString();return/*#__PURE__*/_jsx(\"div\",{class:\"fileInputContainer\",children:/*#__PURE__*/_jsxs(\"label\",{htmlFor:id,children:[/*#__PURE__*/_jsx(\"form\",{ref:form,children:/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:id,style:{display:\"none\"},name:\"file\",onChange:onInputChange})}),/*#__PURE__*/_jsxs(\"div\",{class:\"fileInputContent \".concat(!path?\"clickToSelectFile\":\"\"),children:[isLoading?/*#__PURE__*/_jsx(\"i\",{class:\"fa fa-circle-notch fa-spin\"}):null,!isLoading&&!path?/*#__PURE__*/_jsx(\"div\",{children:\"Cliquez pour s\\xE9lectionner un fichier\"}):null,!isLoading&&path?/*#__PURE__*/_jsxs(\"div\",{class:\"nonImageFileOutput\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Fichier t\\xE9l\\xE9charg\\xE9\"}),/*#__PURE__*/_jsx(\"div\",{class:\"deleteFile\",onClick:deleteFile,children:/*#__PURE__*/_jsx(\"i\",{class:\"fal fa-trash-alt\"})})]}):null]})]})});});","map":{"version":3,"names":["useRef","useState","axios","useParams","jsx","_jsx","jsxs","_jsxs","_ref","column","onChange","initialData","form","_useParams","viewIndex","_useState","_useState2","_slicedToArray","isLoading","setIsLoading","_useState3","name","_useState4","path","setPath","onInputChange","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","f","response","fileData","wrap","_callee$","_context","prev","next","FormData","current","method","url","data","params","columnId","__id__","headers","sent","_defineProperty","aspectRatioField","aspectRatio","originalNameField","originalFilename","stop","apply","arguments","deleteFile","e","preventDefault","id","Math","random","toString","class","children","htmlFor","ref","type","style","display","concat","onClick"],"sources":["/home/runner/work/galadmin/galadmin/src/front/src/components/inputs/FileInput.js"],"sourcesContent":["import { useRef, useState } from \"react\";\nimport axios from \"axios\";\nimport {\n    useParams\n} from \"react-router-dom\";\n\n\nexport default ({ column, onChange, initialData }) => {\n    const form = useRef(null);\n    const { viewIndex } = useParams();\n    const [isLoading, setIsLoading] = useState(false)\n    const [path, setPath] = useState(initialData?.[column.name])\n\n    const onInputChange = async () => {\n        const f = new FormData(form.current);\n        setIsLoading(true);\n\n        const response = await axios({\n            method: \"post\",\n            url: `/uploadFile`,\n            data: f,\n            params: {\n                viewIndex,\n                columnId: column.__id__\n            },\n            headers: { \"Content-Type\": \"multipart/form-data\" }\n        })\n        const fileData = {\n            [column.name]: response.data.path\n        }\n        if (column.aspectRatioField) {\n            fileData[column.aspectRatioField] = response.data.aspectRatio\n        }\n        if (column.originalNameField) {\n            fileData[column.originalNameField] = response.data.originalFilename\n        }\n        onChange(fileData)\n        setIsLoading(false)\n        setPath(response.data.path)\n        // var showAsPicture = $(this).data(\"showAsPicture\") === 1\n        //var baseUrl = $(\".fileInputContent[data-input-id='\" + inputId + \"']\").data(\"baseUrl\")\n        //$(\".fileInputContent[data-input-id='\" + inputId + \"']\").removeClass(\"clickToSelectFile\").html(showAsPicture ? \"<div><img src='https://res.cloudinary.com/forest2/image/fetch/w_600,h_300,c_fit/\" + baseUrl + data.path + \"' /><div class='deleteFile'><i class='fal fa-trash-alt'></i></div></div>\" : \"<div class='nonImageFileOutput'><span>Fichier téléchargé</span><div class='deleteFile'><i class='fal fa-trash-alt'></i></div></div>\"\n    }\n\n    const deleteFile = (e) => {\n        setPath(null);\n        const fileData = {\n            [column.name]: null\n        }\n        if (column.aspectRatioField) {\n            fileData[column.aspectRatioField] = null\n        }\n        if (column.originalNameField) {\n            fileData[column.originalNameField] = null\n        }\n        onChange(fileData)\n        e.preventDefault()\n    }\n\n    var id = Math.random().toString()\n    return (\n        <div class='fileInputContainer'>\n            <label htmlFor={id}>\n                <form ref={form}>\n                    <input type='file' id={id} style={{ display: \"none\" }} name='file' onChange={onInputChange} />\n                </form>\n                <div class={`fileInputContent ${!path ? \"clickToSelectFile\" : \"\"}`}>\n                    {isLoading ?\n                        <i class='fa fa-circle-notch fa-spin'></i>\n                        : null\n                    }\n                    {!isLoading && !path ?\n                        <div>Cliquez pour sélectionner un fichier</div>\n                        : null}\n                    {!isLoading && path ? (\n                        <div class='nonImageFileOutput'>\n                            <span>Fichier téléchargé</span>\n                            <div class='deleteFile' onClick={deleteFile}><i class='fal fa-trash-alt'></i></div>\n                        </div>\n                    ) : null}\n                </div>\n            </label>\n        </div>\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}