{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from\"react\";import{useHistory,useParams}from\"react-router-dom\";import axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default(function(_ref){var panel=_ref.panel,record=_ref.record,view=_ref.view;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),results=_useState2[0],setResults=_useState2[1];var history=useHistory();var _useParams=useParams(),viewIndex=_useParams.viewIndex;useEffect(function(){refreshData();},[panel.query,record]);var refreshData=function refreshData(){axios.get(\"/customQuery\",{params:{query:panel.query,primaryValue:record[view.primaryId]}}).then(function(response){setResults(response.data);});};var deleteRow=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(row){var willDelete;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return window.swal({title:\"Êtes-vous sûr ?\",text:\"Une fois la suppression confirmée, il ne sera pas possible de revenir en arrière.\",buttons:[\"Annuler\",\"Oui\"],dangerMode:true});case 2:willDelete=_context.sent;if(!willDelete){_context.next=13;break;}_context.prev=4;_context.next=7;return axios.post(\"/deleteRecordFromPanel\",{viewIndex:viewIndex,panelId:panel.__id__,primaryValue:row[panel.primaryId]});case 7:refreshData();_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](4);window.swal({title:\"Erreur\",text:\"Suppression impossible\",dangerMode:true});case 13:case\"end\":return _context.stop();}},_callee,null,[[4,10]]);}));return function deleteRow(_x){return _ref2.apply(this,arguments);};}();var pathField=panel.pathField||\"Path\";return/*#__PURE__*/_jsx(\"div\",{children:(results===null||results===void 0?void 0:results.length)>0?/*#__PURE__*/_jsx(\"div\",{class:\"gallery\",children:results.map(function(result){return/*#__PURE__*/_jsxs(\"div\",{class:\"galleryPicture\",children:[panel.canDelete?/*#__PURE__*/_jsx(\"div\",{class:\"deleteIcon\",onClick:function onClick(e){deleteRow(result);e.stopPropagation();},children:/*#__PURE__*/_jsx(\"i\",{class:\"fa fa-minus\"})}):null,/*#__PURE__*/_jsx(\"a\",{href:panel.baseUrl+result[pathField],target:\"_blank\",children:/*#__PURE__*/_jsx(\"img\",{src:panel.baseUrl+result[pathField],style:{width:\"100%\",height:150,objectFit:panel.objectFit||\"cover\"},onerror:\"this.style.height = 0\"})})]},result[pathField]);})}):(results===null||results===void 0?void 0:results.length)===0?/*#__PURE__*/_jsx(\"div\",{class:\"noData panelTable \".concat(panel.folded?\"folded\":\"\"),children:\"Aucune donn\\xE9e\"}):null});});","map":{"version":3,"names":["useState","useEffect","useHistory","useParams","axios","jsx","_jsx","jsxs","_jsxs","_ref","panel","record","view","_useState","_useState2","_slicedToArray","results","setResults","history","_useParams","viewIndex","refreshData","query","get","params","primaryValue","primaryId","then","response","data","deleteRow","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","row","willDelete","wrap","_callee$","_context","prev","next","window","swal","title","text","buttons","dangerMode","sent","post","panelId","__id__","t0","stop","_x","apply","arguments","pathField","children","length","class","map","result","canDelete","onClick","e","stopPropagation","href","baseUrl","target","src","style","width","height","objectFit","onerror","concat","folded"],"sources":["/home/runner/work/galadmin/galadmin/src/front/src/components/panels/GalleryPanel.js"],"sourcesContent":["import { useState, useEffect } from \"react\"\nimport {\n    useHistory,\n    useParams\n} from \"react-router-dom\";\nimport axios from \"axios\";\n\nexport default ({ panel, record, view }) => {\n    const [results, setResults] = useState(null);\n    const history = useHistory();\n    const { viewIndex } = useParams();\n\n    useEffect(() => {\n        refreshData()\n    }, [panel.query, record])\n\n    const refreshData = () => {\n        axios.get(\"/customQuery\", {\n            params: {\n                query: panel.query,\n                primaryValue: record[view.primaryId]\n            }\n        }).then((response) => {\n            setResults(response.data)\n        })\n    }\n    const deleteRow = async (row) => {\n        const willDelete = await window.swal({\n            title: \"Êtes-vous sûr ?\",\n            text: \"Une fois la suppression confirmée, il ne sera pas possible de revenir en arrière.\",\n            buttons: [\"Annuler\", \"Oui\"],\n            dangerMode: true\n        })\n        if (willDelete) {\n            try {\n                await axios.post(\"/deleteRecordFromPanel\", {\n                    viewIndex,\n                    panelId: panel.__id__,\n                    primaryValue: row[panel.primaryId]\n                })\n                refreshData();\n            } catch (e) {\n                window.swal({\n                    title: \"Erreur\",\n                    text: \"Suppression impossible\",\n                    dangerMode: true\n                })\n            }\n        }\n    }\n\n    const pathField = panel.pathField || \"Path\"\n\n    return (\n        <div>\n            {results?.length > 0 ? (\n                <div class=\"gallery\">\n                    {results.map((result) => (\n                        <div class='galleryPicture' key={result[pathField]}>\n                            {panel.canDelete ? <div class='deleteIcon' onClick={(e) => {deleteRow(result); e.stopPropagation()}}><i class='fa fa-minus'></i></div> : null}\n                            <a href={panel.baseUrl + result[pathField]} target='_blank'>\n                                <img\n                                    src={panel.baseUrl + result[pathField]}\n                                    style={{ width: \"100%\", height: 150, objectFit: panel.objectFit || \"cover\" }}\n                                    onerror='this.style.height = 0'\n                                />\n                            </a>\n                        </div>\n                    ))}\n                </div>\n            ) : results?.length === 0 ? (\n                <div class={`noData panelTable ${panel.folded ? \"folded\" : \"\"}`}>Aucune donnée</div>\n            ) : null}\n        </div>\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}