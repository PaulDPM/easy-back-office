{"ast":null,"code":"import _slicedToArray from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from\"react\";import axios from\"axios\";import{useParams}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default(function(_ref){var panel=_ref.panel,record=_ref.record,view=_ref.view,index=_ref.index;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];var _useParams=useParams(),viewIndex=_useParams.viewIndex;useEffect(function(){refreshData();},[record]);useEffect(function(){var handler=function handler(event){if(event.key===\"Enter\"){sendMessage();}};document.addEventListener(\"keydown\",handler);return function(){document.removeEventListener(\"keydown\",handler);};},[message]);var refreshData=function refreshData(){axios.get(\"/customQuery\",{params:{viewIndex:viewIndex,panelIndex:index,query:panel.getMessagesQuery,primaryValue:record[view.primaryId]}}).then(function(response){setMessages(response.data);});};var sendMessage=function sendMessage(){axios.post(panel.postMessageUrl,{form:{message:message,recipientId:record[view.primaryId],secretKey:panel.secretKey}});};return/*#__PURE__*/_jsxs(\"div\",{children:[(messages===null||messages===void 0?void 0:messages.length)>0?/*#__PURE__*/_jsx(\"div\",{class:\"messagesContainer\",children:messages.map(function(message,index){return/*#__PURE__*/_jsx(\"div\",{class:\"message \".concat(message[panel.isAdminField]?'adminMessage':'userMessage'),children:message[panel.messageField]},index);})}):/*#__PURE__*/_jsx(\"div\",{class:\"noData panelTable\",children:\"Aucun message\"}),/*#__PURE__*/_jsxs(\"div\",{class:\"sendMessageContainer\",children:[/*#__PURE__*/_jsx(\"input\",{class:\"sendMessageInput\",type:\"text\",onChange:function onChange(event){return setMessage(event.target.value);}}),/*#__PURE__*/_jsx(\"div\",{class:\"sendButton\",onClick:sendMessage,children:/*#__PURE__*/_jsx(\"i\",{class:\"fa fa-send\"})})]})]});});","map":{"version":3,"names":["useState","useEffect","axios","useParams","jsx","_jsx","jsxs","_jsxs","_ref","panel","record","view","index","_useState","_useState2","_slicedToArray","messages","setMessages","_useState3","_useState4","message","setMessage","_useParams","viewIndex","refreshData","handler","event","key","sendMessage","document","addEventListener","removeEventListener","get","params","panelIndex","query","getMessagesQuery","primaryValue","primaryId","then","response","data","post","postMessageUrl","form","recipientId","secretKey","children","length","class","map","concat","isAdminField","messageField","type","onChange","target","value","onClick"],"sources":["/home/runner/work/galadmin/galadmin/src/front/src/components/panels/ChatPanel.js"],"sourcesContent":["import { useState, useEffect } from \"react\"\nimport axios from \"axios\";\nimport {\n    useParams\n} from \"react-router-dom\";\n\nexport default ({ panel, record, view, index }) => {\n    const [messages, setMessages] = useState(null);\n\tconst [message, setMessage] = useState(\"\");\n    const { viewIndex } = useParams();\n\n    useEffect(() => {\n        refreshData()\n    }, [record])\n\n\tuseEffect(() => {\n\t\tconst handler = (event) => {\n\t\t\tif (event.key === \"Enter\") {\n\t\t\t\tsendMessage()\n\t\t\t}\n\t\t}\n\t\tdocument.addEventListener(\"keydown\", handler)\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"keydown\", handler)\n\t\t}\n\t}, [message])\n\n    const refreshData = () => {\n        axios.get(\"/customQuery\", {\n            params: {\n                viewIndex,\n                panelIndex: index,\n                query: panel.getMessagesQuery,\n                primaryValue: record[view.primaryId]\n            }\n        }).then((response) => {\n            setMessages(response.data)\n        })\n    }\n\n\tconst sendMessage = () => {\n\t\taxios.post(panel.postMessageUrl, {\n\t\t\tform: {\n\t\t\t\tmessage,\n\t\t\t\trecipientId: record[view.primaryId],\n\t\t\t\tsecretKey: panel.secretKey\n\t\t\t}\n\t\t})\n\t}\n\n    return (\n        <div>\n\t\t\t{messages?.length > 0 ? (\n\t\t\t\t<div class=\"messagesContainer\">\n\t\t\t\t\t{messages.map((message, index) => (\n\t\t\t\t\t\t<div key={index} class={`message ${message[panel.isAdminField] ? 'adminMessage' : 'userMessage'}`}>\n\t\t\t\t\t\t\t{message[panel.messageField]}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\t\t\t) : (\n\t\t\t\t<div class={`noData panelTable`}>Aucun message</div>\n\t\t\t)}\n\t\t\t<div class=\"sendMessageContainer\">\n\t\t\t\t<input class=\"sendMessageInput\" type=\"text\" onChange={(event) => setMessage(event.target.value)} />\n\t\t\t\t<div class=\"sendButton\" onClick={sendMessage}><i class=\"fa fa-send\"></i></div>\n\t\t\t</div>\n        </div>\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}