{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useContext,useRef,useState,useEffect}from\"react\";import{useParams,useHistory}from\"react-router-dom\";import axios from\"axios\";import Input from\"../components/Input\";import LabelTooltip from\"../components/LabelTooltip\";import{ConfigContext}from'../contexts/ConfigContext';import checkRequiredColumns from\"../utils/checkRequiredColumns\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default(function(){var config=useContext(ConfigContext);var _useParams=useParams(),viewIndex=_useParams.viewIndex,recordId=_useParams.recordId;var history=useHistory();var view=config.views[viewIndex];var _useState=useState(null),_useState2=_slicedToArray(_useState,2),record=_useState2[0],setRecord=_useState2[1];var filteredColumns=view.columns.filter(function(column){return column.dataType&&column.canEdit!==false&&!column.hidden;});var dataToUpdate=useRef({});var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isUpdating=_useState4[0],setIsUpdating=_useState4[1];useEffect(function(){axios.get(\"/record\",{params:{viewIndex:viewIndex,recordId:recordId}}).then(function(response){dataToUpdate.current={};setRecord(response.data);});},[viewIndex,recordId]);var updateRecord=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(checkRequiredColumns(filteredColumns,_objectSpread(_objectSpread({},record),dataToUpdate.current))){_context.next=2;break;}return _context.abrupt(\"return\");case 2:setIsUpdating(true);_context.prev=3;_context.next=6;return axios.post(\"/updateRecord\",{viewIndex:viewIndex,primaryValue:recordId,data:dataToUpdate.current,previousData:record});case 6:setIsUpdating(false);history.push(\"/record/\".concat(viewIndex,\"/\").concat(recordId));_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](3);if(_context.t0.response.responseText){window.swal({title:\"Erreur\",text:_context.t0.response.responseText,dangerMode:true});}setIsUpdating(false);case 14:case\"end\":return _context.stop();}},_callee,null,[[3,10]]);}));return function updateRecord(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{class:\"view\",children:[/*#__PURE__*/_jsx(\"div\",{class:\"viewHeader\",children:/*#__PURE__*/_jsx(\"div\",{class:\"viewTitle\",children:view.label})}),/*#__PURE__*/_jsx(\"div\",{class:\"paddedView\",children:record?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{class:\"form\",children:filteredColumns.map(function(column,index){return/*#__PURE__*/_jsxs(\"div\",{class:\"formElement\",children:[/*#__PURE__*/_jsxs(\"div\",{class:\"formLabel\",children:[column.label,\" \",column.required?\"*\":\"\",column.labelTooltip?/*#__PURE__*/_jsx(LabelTooltip,{text:column.labelTooltip}):null]}),/*#__PURE__*/_jsx(\"div\",{class:\"formInput\",children:/*#__PURE__*/_jsx(Input,{column:column,initialData:record,onChange:function onChange(newValues){dataToUpdate.current=_objectSpread(_objectSpread({},dataToUpdate.current),newValues);}})})]},index);})}),/*#__PURE__*/_jsx(\"div\",{class:\"button greenButton \".concat(isUpdating?\"loading\":\"\"),onClick:updateRecord,children:isUpdating?\"Sauvegarde en cours...\":\"Sauvegarder\"}),/*#__PURE__*/_jsx(\"div\",{class:\"button\",onClick:function onClick(){return history.goBack();},children:\"Annuler\"})]}):null})]});});","map":{"version":3,"names":["useContext","useRef","useState","useEffect","useParams","useHistory","axios","Input","LabelTooltip","ConfigContext","checkRequiredColumns","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","config","_useParams","viewIndex","recordId","history","view","views","_useState","_useState2","_slicedToArray","record","setRecord","filteredColumns","columns","filter","column","dataType","canEdit","hidden","dataToUpdate","_useState3","_useState4","isUpdating","setIsUpdating","get","params","then","response","current","data","updateRecord","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","_objectSpread","abrupt","post","primaryValue","previousData","push","concat","t0","responseText","window","swal","title","text","dangerMode","stop","apply","arguments","class","children","label","map","index","required","labelTooltip","initialData","onChange","newValues","onClick","goBack"],"sources":["/home/runner/work/galadmin/galadmin/src/front/src/pages/EditRecord.js"],"sourcesContent":["import { useContext, useRef, useState, useEffect } from \"react\";\nimport {\n    useParams,\n    useHistory\n} from \"react-router-dom\";\nimport axios from \"axios\";\nimport Input from \"../components/Input\"\nimport LabelTooltip from \"../components/LabelTooltip\"\nimport { ConfigContext } from '../contexts/ConfigContext'\nimport checkRequiredColumns from \"../utils/checkRequiredColumns\";\n\nexport default () => {\n    const config = useContext(ConfigContext)\n    const { viewIndex, recordId } = useParams();\n    const history = useHistory();\n    const view = config.views[viewIndex];\n    const [record, setRecord] = useState(null);\n    const filteredColumns = view.columns.filter(\n        column => column.dataType &&\n            column.canEdit !== false &&\n            !column.hidden\n    )\n\n    const dataToUpdate = useRef({})\n    const [isUpdating, setIsUpdating] = useState(false)\n\n    useEffect(() => {\n        axios.get(\"/record\", {\n            params: {\n                viewIndex,\n                recordId\n            }\n        }).then((response) => {\n            dataToUpdate.current = {};\n            setRecord(response.data);\n        });\n    }, [viewIndex, recordId]);\n\n    const updateRecord = async () => {\n        if (!checkRequiredColumns(filteredColumns, {...record, ...dataToUpdate.current})) return;\n        setIsUpdating(true)\n        try {\n            await axios.post(\"/updateRecord\", {\n                viewIndex,\n                primaryValue: recordId,\n                data: dataToUpdate.current,\n                previousData: record\n            })\n            setIsUpdating(false)\n            history.push(`/record/${viewIndex}/${recordId}`)\n        } catch (error) {\n            if (error.response.responseText) {\n                window.swal({\n                    title: \"Erreur\",\n                    text: error.response.responseText,\n                    dangerMode: true\n                })\n            }\n            setIsUpdating(false)\n        }\n    }\n\n    return (\n        <div class=\"view\">\n            <div class=\"viewHeader\">\n                <div class=\"viewTitle\">{view.label}</div>\n            </div>\n            <div class=\"paddedView\">\n                {record ? (\n                    <>\n                        <div class=\"form\">\n                            {filteredColumns.map((column, index) => {\n                                return (\n                                    <div class='formElement' key={index}>\n                                        <div class='formLabel'>\n                                            {column.label} {column.required ? \"*\" : \"\"}\n                                            {column.labelTooltip ? <LabelTooltip text={column.labelTooltip} /> : null}\n                                        </div>\n                                        <div class='formInput'>\n                                            <Input\n                                                column={column}\n                                                initialData={record}\n                                                onChange={(newValues) => { dataToUpdate.current = { ...dataToUpdate.current, ...newValues } }}\n                                            />\n                                        </div>\n                                    </div>\n                                )\n                            })}\n                        </div>\n                        <div class={`button greenButton ${isUpdating ? \"loading\" : \"\"}`} onClick={updateRecord}>{isUpdating ? \"Sauvegarde en cours...\" : \"Sauvegarder\"}</div>\n                        <div class=\"button\" onClick={() => history.goBack()}>Annuler</div>\n                    </>\n                ) : null}\n            </div>\n        </div>\n    )\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}