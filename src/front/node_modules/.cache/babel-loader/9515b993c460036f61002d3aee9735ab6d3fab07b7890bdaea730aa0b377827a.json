{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect,useContext}from\"react\";import axios from\"axios\";import evalExpression from\"../../utils/evalExpression\";import{useHistory,useParams}from\"react-router-dom\";import{ConfigContext}from\"../../contexts/ConfigContext\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default(function(_ref){var panel=_ref.panel,record=_ref.record,view=_ref.view,index=_ref.index;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),results=_useState2[0],setResults=_useState2[1];var history=useHistory();var _useParams=useParams(),viewIndex=_useParams.viewIndex;var config=useContext(ConfigContext);useEffect(function(){refreshData();},[record]);var refreshData=function refreshData(){axios.get(\"/customQuery\",{params:{viewIndex:viewIndex,panelIndex:index,query:panel.query||evalExpression(panel.formattedQuery,record),primaryValue:record[view.primaryId]}}).then(function(response){setResults(response.data);});};var deleteRow=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(row){var willDelete;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return window.swal({title:\"Êtes-vous sûr ?\",text:\"Une fois la suppression confirmée, il ne sera pas possible de revenir en arrière.\",buttons:[\"Annuler\",\"Oui\"],dangerMode:true});case 2:willDelete=_context.sent;if(!willDelete){_context.next=13;break;}_context.prev=4;_context.next=7;return axios.post(\"/deleteRecordFromPanel\",{viewIndex:viewIndex,panelId:panel.__id__,primaryValue:row[panel.primaryId]});case 7:refreshData();_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](4);window.swal({title:\"Erreur\",text:\"Suppression impossible\",dangerMode:true});case 13:case\"end\":return _context.stop();}},_callee,null,[[4,10]]);}));return function deleteRow(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{children:(results===null||results===void 0?void 0:results.length)>0?/*#__PURE__*/_jsxs(\"table\",{class:\"table panelTable \".concat(panel.folded?\"folded\":\"\"),children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[Object.keys(results[0]).filter(function(key){return key!==panel.primaryId;}).map(function(key){return/*#__PURE__*/_jsx(\"th\",{children:key},key);}),panel.canDelete?/*#__PURE__*/_jsx(\"th\",{}):null]})}),/*#__PURE__*/_jsx(\"tbody\",{children:results.map(function(result){return/*#__PURE__*/_jsxs(\"tr\",{class:\"record \".concat(panel.canShow?\"\":\"nonClickableRow\"),onClick:function onClick(){var viewIndex=config.views.findIndex(function(x){return x.type===\"table\"&&x.tableName===panel.tableName;});if(panel.canShow){history.push(\"/record/\".concat(viewIndex,\"/\").concat(result[panel.primaryId]));}},children:[Object.keys(result).filter(function(key){return key!==panel.primaryId;}).map(function(key){return/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"div\",{dangerouslySetInnerHTML:{__html:panel.formattedValues&&key in panel.formattedValues?evalExpression(panel.formattedValues[key],result):result[key]}})},key);}),panel.canDelete?/*#__PURE__*/_jsx(\"td\",{class:\"deleteIconCell\",children:/*#__PURE__*/_jsx(\"div\",{class:\"deleteIcon\",onClick:function onClick(e){deleteRow(result);e.stopPropagation();},children:/*#__PURE__*/_jsx(\"i\",{class:\"fa fa-minus\"})})}):null]});})})]}):(results===null||results===void 0?void 0:results.length)===0?/*#__PURE__*/_jsx(\"div\",{class:\"noData panelTable \".concat(panel.folded?\"folded\":\"\"),children:\"Aucune donn\\xE9e\"}):null});});","map":{"version":3,"names":["useState","useEffect","useContext","axios","evalExpression","useHistory","useParams","ConfigContext","jsx","_jsx","jsxs","_jsxs","_ref","panel","record","view","index","_useState","_useState2","_slicedToArray","results","setResults","history","_useParams","viewIndex","config","refreshData","get","params","panelIndex","query","formattedQuery","primaryValue","primaryId","then","response","data","deleteRow","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","row","willDelete","wrap","_callee$","_context","prev","next","window","swal","title","text","buttons","dangerMode","sent","post","panelId","__id__","t0","stop","_x","apply","arguments","children","length","class","concat","folded","Object","keys","filter","key","map","canDelete","result","canShow","onClick","views","findIndex","x","type","tableName","push","dangerouslySetInnerHTML","__html","formattedValues","e","stopPropagation"],"sources":["/home/runner/work/galadmin/galadmin/src/front/src/components/panels/TablePanel.js"],"sourcesContent":["import { useState, useEffect, useContext } from \"react\"\nimport axios from \"axios\";\nimport evalExpression from \"../../utils/evalExpression\";\nimport {\n    useHistory,\n    useParams\n} from \"react-router-dom\";\nimport { ConfigContext } from \"../../contexts/ConfigContext\";\n\nexport default ({ panel, record, view, index }) => {\n    const [results, setResults] = useState(null);\n    const history = useHistory();\n    const { viewIndex } = useParams();\n    const config = useContext(ConfigContext)\n\n    useEffect(() => {\n        refreshData()\n    }, [record])\n\n    const refreshData = () => {\n        axios.get(\"/customQuery\", {\n            params: {\n                viewIndex,\n                panelIndex: index,\n                query: panel.query || evalExpression(panel.formattedQuery, record),\n                primaryValue: record[view.primaryId]\n            }\n        }).then((response) => {\n            setResults(response.data)\n        })\n    }\n\n    const deleteRow = async (row) => {\n        const willDelete = await window.swal({\n            title: \"Êtes-vous sûr ?\",\n            text: \"Une fois la suppression confirmée, il ne sera pas possible de revenir en arrière.\",\n            buttons: [\"Annuler\", \"Oui\"],\n            dangerMode: true\n        })\n        if (willDelete) {\n            try {\n                await axios.post(\"/deleteRecordFromPanel\", {\n                    viewIndex,\n                    panelId: panel.__id__,\n                    primaryValue: row[panel.primaryId]\n                })\n                refreshData();\n            } catch (e) {\n                window.swal({\n                    title: \"Erreur\",\n                    text: \"Suppression impossible\",\n                    dangerMode: true\n                })\n            }\n        }\n    }\n\n    return (\n        <div>\n            {results?.length > 0 ? (\n                <table class={`table panelTable ${panel.folded ? \"folded\" : \"\"}`}>\n                    <thead>\n                        <tr>\n                            {Object.keys(results[0]).filter(key => key !== panel.primaryId).map((key) =>\n                                <th key={key}>{key}</th>\n                            )}\n                            {panel.canDelete ? <th></th> : null}\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {results.map((result) => (\n                            <tr\n                                class={`record ${panel.canShow ? \"\" : \"nonClickableRow\"}`}\n                                onClick={() => {\n                                    const viewIndex = config.views.findIndex(x => x.type === \"table\" && x.tableName === panel.tableName)\n                                    if (panel.canShow) {\n                                        history.push(`/record/${viewIndex}/${result[panel.primaryId]}`)\n                                    }\n                                }}\n                            >\n                                {Object.keys(result).filter(key => key !== panel.primaryId).map((key) =>\n                                    <td key={key}>\n                                        <div\n                                            dangerouslySetInnerHTML={{\n                                                __html:\n                                                    (panel.formattedValues && (key in panel.formattedValues)) ?\n                                                        evalExpression(panel.formattedValues[key], result) :\n                                                        result[key]\n                                            }}\n                                        />\n                                    </td>\n                                )}\n                                {panel.canDelete ? (\n                                    <td class='deleteIconCell'>\n                                        <div\n                                            class='deleteIcon'\n                                            onClick={(e) => {deleteRow(result); e.stopPropagation()}}\n                                        >\n                                            <i class='fa fa-minus'></i>\n                                        </div>\n                                    </td>\n                                ) : null}\n                            </tr>\n                        ))}\n                    </tbody>\n                </table>\n            ) : results?.length === 0 ? (\n                <div class={`noData panelTable ${panel.folded ? \"folded\" : \"\"}`}>Aucune donnée</div>\n            ) : null}\n        </div>\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}