{"ast":null,"code":"import _defineProperty from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _slicedToArray from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import axios from\"axios\";import{useEffect,useRef,useState}from\"react\";import{useParams}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default(function(_ref){var _options$find2;var column=_ref.column,_onChange2=_ref.onChange,initialData=_ref.initialData;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),options=_useState2[0],setOptions=_useState2[1];var _useParams=useParams(),viewIndex=_useParams.viewIndex;var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),query=_useState4[0],setQuery=_useState4[1];var input=useRef(null);var isInputValid=useRef(false);useEffect(function(){axios.post(\"/foreignSelectRecords\",{viewIndex:viewIndex,columnId:column.__id__,query:query}).then(function(response){setOptions(response.data);});},[query]);useEffect(function(){var _input$current;var setInputValue=function setInputValue(){if(input.current&&!isInputValid.current){input.current.value=\"\";}};input===null||input===void 0?void 0:(_input$current=input.current)===null||_input$current===void 0?void 0:_input$current.addEventListener(\"focusout\",setInputValue);return function(){var _input$current2;return input===null||input===void 0?void 0:(_input$current2=input.current)===null||_input$current2===void 0?void 0:_input$current2.removeEventListener(\"focusout\",setInputValue);};},[input.current]);var id=Math.random();return options===null?/*#__PURE__*/_jsx(\"i\",{class:\"fa fa-circle-notch fa-spin\",style:{color:\"#536579\"}}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",list:id,ref:input,onChange:function onChange(e){var _options$find$value,_options$find;var value=(_options$find$value=(_options$find=options.find(function(x){return x.label===e.target.value;}))===null||_options$find===void 0?void 0:_options$find.value)!==null&&_options$find$value!==void 0?_options$find$value:null;isInputValid.current=!!value;setQuery(e.target.value);_onChange2(_defineProperty({},column.name,value));},defaultValue:(_options$find2=options.find(function(x){return x.value===(initialData===null||initialData===void 0?void 0:initialData[column.name]);}))===null||_options$find2===void 0?void 0:_options$find2.label}),/*#__PURE__*/_jsxs(\"datalist\",{id:id,children:[column.optional?/*#__PURE__*/_jsx(\"option\",{value:\"NULL\",children:\"-\"}):null,options.map(function(option){return/*#__PURE__*/_jsx(\"option\",{value:option.label,children:option.label},option.value);})]})]});});","map":{"version":3,"names":["axios","useEffect","useRef","useState","useParams","jsx","_jsx","jsxs","_jsxs","_ref","_options$find2","column","onChange","initialData","_useState","_useState2","_slicedToArray","options","setOptions","_useParams","viewIndex","_useState3","_useState4","query","setQuery","input","isInputValid","post","columnId","__id__","then","response","data","_input$current","setInputValue","current","value","addEventListener","_input$current2","removeEventListener","id","Math","random","class","style","color","children","type","list","ref","e","_options$find$value","_options$find","find","x","label","target","_defineProperty","name","defaultValue","optional","map","option"],"sources":["/home/runner/work/galadmin/galadmin/src/front/src/components/inputs/ForeignDatalistInput.js"],"sourcesContent":["import axios from \"axios\";\nimport { useEffect, useRef, useState } from \"react\"\nimport {\n    useParams\n} from \"react-router-dom\";\n\nexport default ({ column, onChange, initialData }) => {\n    const [options, setOptions] = useState([])\n    const { viewIndex } = useParams();\n    const [query, setQuery] = useState(\"\")\n    const input = useRef(null)\n    const isInputValid = useRef(false)\n\n    useEffect(() => {\n        axios.post(\"/foreignSelectRecords\", {\n            viewIndex,\n            columnId: column.__id__,\n            query\n        }).then((response) => {\n            setOptions(response.data)\n        })\n    }, [query])\n\n    useEffect(() => {\n        const setInputValue = () => {\n            if (input.current && !isInputValid.current) {\n                input.current.value = \"\"\n            }\n        }\n        input?.current?.addEventListener(\"focusout\", setInputValue)\n        return () => input?.current?.removeEventListener(\"focusout\", setInputValue)\n    }, [input.current])\n\n    const id = Math.random();\n\n    return options === null ? (\n        <i class='fa fa-circle-notch fa-spin' style={{ color: \"#536579\" }}></i>\n    ) : (\n        <div>\n            <input\n                type='text'\n                list={id}\n                ref={input}\n                onChange={(e) => {\n                    const value = options.find(x => x.label === e.target.value)?.value ?? null;\n                    isInputValid.current = !!value\n                    setQuery(e.target.value);\n                    onChange({ [column.name]: value })\n                }}\n                defaultValue={options.find(x => x.value === initialData?.[column.name])?.label}\n            />\n            <datalist id={id}>\n                {column.optional ? <option value='NULL'>-</option> : null}\n                {options.map((option) => {\n                    return (\n                        <option value={option.label} key={option.value}>\n                            {option.label}\n                        </option>\n                    )\n                })}\n            </datalist>\n        </div>\n    );\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}