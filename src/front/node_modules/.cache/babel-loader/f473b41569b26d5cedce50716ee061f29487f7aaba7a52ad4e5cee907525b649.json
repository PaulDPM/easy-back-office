{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/runner/work/galadmin/galadmin/src/front/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useContext,useState}from\"react\";import{useHistory}from\"react-router-dom\";import axios from\"axios\";import OutsideClickHandler from\"./OutsideClickHandler\";import{ConfigContext}from\"../contexts/ConfigContext\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default(function(_ref){var _view$customActions,_view$customActions2;var viewIndex=_ref.viewIndex,record=_ref.record,refreshData=_ref.refreshData;var config=useContext(ConfigContext);var view=config.views[viewIndex];var _useState=useState(false),_useState2=_slicedToArray(_useState,2),actionsOpened=_useState2[0],setActionsOpened=_useState2[1];var history=useHistory();var deleteRecord=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var willDelete;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return window.swal({title:\"Êtes-vous sûr ?\",text:\"Une fois la suppression confirmée, il ne sera pas possible de revenir en arrière.\",buttons:[\"Annuler\",\"Oui\"],dangerMode:true});case 2:willDelete=_context.sent;if(!willDelete){_context.next=14;break;}if(view.deleteCallback){axios.post(view.deleteCallback,{id:record[view.primaryId],data:record});}_context.prev=5;_context.next=8;return axios.post(\"/deleteRecord\",{viewIndex:viewIndex,primaryValue:record[view.primaryId]});case 8:history.push(\"/records/\".concat(viewIndex));_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](5);window.swal({title:\"Erreur\",text:\"Suppression impossible\",dangerMode:true});case 14:case\"end\":return _context.stop();}},_callee,null,[[5,11]]);}));return function deleteRecord(){return _ref2.apply(this,arguments);};}();var customAction=function customAction(actionIndex){return function(){setActionsOpened(false);axios.post(\"customAction\",{viewIndex:viewIndex,actionIndex:actionIndex,selectedRecordIds:[record[view.primaryId]]}).then(function(response){if(response.data.message){alert(response.data.message);}refreshData();}).catch(function(){window.swal({title:\"Erreur\",text:\"L'action a échoué\",dangerMode:true});});};};return view.canDuplicate===true||view.canDelete!==false||((_view$customActions=view.customActions)===null||_view$customActions===void 0?void 0:_view$customActions.length)>0?/*#__PURE__*/_jsx(OutsideClickHandler,{onOutsideClick:function onOutsideClick(){return setActionsOpened(false);},children:/*#__PURE__*/_jsxs(\"div\",{class:\"actionButtonsContainer\",children:[/*#__PURE__*/_jsx(\"div\",{class:\"button openActionsButton\",onClick:function onClick(){return setActionsOpened(!actionsOpened);},children:\"Actions\"}),actionsOpened?/*#__PURE__*/_jsxs(\"div\",{class:\"actions\",children:[(_view$customActions2=view.customActions)===null||_view$customActions2===void 0?void 0:_view$customActions2.map(function(action,index){return/*#__PURE__*/_jsx(\"div\",{class:\"action recordAction\",onClick:customAction(index),children:action.label});}),view.canDuplicate===true?/*#__PURE__*/_jsx(\"div\",{class:\"action recordAction duplicateRecord\",children:\"Dupliquer\"}):null,view.canDelete!==false?/*#__PURE__*/_jsx(\"div\",{class:\"action recordAction red\",onClick:deleteRecord,children:\"Supprimer\"}):null]}):null]})}):null;});","map":{"version":3,"names":["useContext","useState","useHistory","axios","OutsideClickHandler","ConfigContext","jsx","_jsx","jsxs","_jsxs","_ref","_view$customActions","_view$customActions2","viewIndex","record","refreshData","config","view","views","_useState","_useState2","_slicedToArray","actionsOpened","setActionsOpened","history","deleteRecord","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","willDelete","wrap","_callee$","_context","prev","next","window","swal","title","text","buttons","dangerMode","sent","deleteCallback","post","id","primaryId","data","primaryValue","push","concat","t0","stop","apply","arguments","customAction","actionIndex","selectedRecordIds","then","response","message","alert","catch","canDuplicate","canDelete","customActions","length","onOutsideClick","children","class","onClick","map","action","index","label"],"sources":["/home/runner/work/galadmin/galadmin/src/front/src/components/ActionsButton.js"],"sourcesContent":["\nimport { useContext, useState } from \"react\"\nimport {\n    useHistory\n} from \"react-router-dom\";\nimport axios from \"axios\";\nimport OutsideClickHandler from \"./OutsideClickHandler\"\nimport { ConfigContext } from \"../contexts/ConfigContext\";\n\nexport default ({ viewIndex, record, refreshData }) => {\n    const config = useContext(ConfigContext)\n    const view = config.views[viewIndex]\n    const [actionsOpened, setActionsOpened] = useState(false)\n    const history = useHistory()\n\n    const deleteRecord = async () => {\n        const willDelete = await window.swal({\n            title: \"Êtes-vous sûr ?\",\n            text: \"Une fois la suppression confirmée, il ne sera pas possible de revenir en arrière.\",\n            buttons: [\"Annuler\", \"Oui\"],\n            dangerMode: true\n        })\n        if (willDelete) {\n            if (view.deleteCallback) {\n                axios.post(view.deleteCallback, {\n                    id: record[view.primaryId],\n                    data: record\n                })\n            }\n            try {\n                await axios.post(\"/deleteRecord\", {\n                    viewIndex,\n                    primaryValue: record[view.primaryId]\n                })\n                history.push(`/records/${viewIndex}`)\n            } catch (e) {\n                window.swal({\n                    title: \"Erreur\",\n                    text: \"Suppression impossible\",\n                    dangerMode: true\n                })\n            }\n        }\n    }\n\n    const customAction = (actionIndex) => () => {\n        setActionsOpened(false)\n        axios.post(\"customAction\", {\n            viewIndex,\n            actionIndex,\n            selectedRecordIds: [record[view.primaryId]]\n        }).then(function (response) {\n            if (response.data.message) {\n                alert(response.data.message)\n            }\n            refreshData()\n        }).catch(function () {\n            window.swal({\n                title: \"Erreur\",\n                text: \"L'action a échoué\",\n                dangerMode: true\n            })\n        });\n    }\n\n    return (\n        (view.canDuplicate === true) || (view.canDelete !== false) || (view.customActions?.length > 0) ? (\n            <OutsideClickHandler onOutsideClick={() => setActionsOpened(false)}>\n                <div class=\"actionButtonsContainer\">\n                    <div class=\"button openActionsButton\" onClick={() => setActionsOpened(!actionsOpened)}>Actions</div>\n                    {actionsOpened ? (\n                        <div class=\"actions\">\n                            {view.customActions?.map((action, index) => (\n                                <div class=\"action recordAction\" onClick={customAction(index)}>{action.label}</div>\n                            ))}\n                            {view.canDuplicate === true ? <div class=\"action recordAction duplicateRecord\">Dupliquer</div> : null}\n                            {view.canDelete !== false ? <div class=\"action recordAction red\" onClick={deleteRecord}>Supprimer</div> : null}\n                        </div>\n                    ) : null}\n                </div>\n            </OutsideClickHandler>\n        ) : null\n\n    )\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}